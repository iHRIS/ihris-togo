"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[3107],{2245:function(){},83702:function(e,t,s){s.d(t,{Z:function(){return n}});s(2245);var i=s(70172),a=s(58230),r=s(7764),n=r.Z.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...a.Z.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(e){this.$nextTick((()=>this.inputIndeterminate=e))},inputIndeterminate(e){this.$emit("update:indeterminate",e)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:e,...t}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(i.Z,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...t,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}})},55533:function(e,t,s){s.d(t,{Z:function(){return r}});var i=s(48085),a=s(73325),r=(0,a.Z)(i.Z).extend({name:"v-subheader",props:{inset:Boolean},render(e){return e("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},89155:function(e,t,s){var i=s(46286),a=s(70538);t["Z"]=a["default"].extend({name:"rippleable",directives:{ripple:i.Z},props:{ripple:{type:[Boolean,Object],default:!0}},methods:{genRipple(e={}){return this.ripple?(e.staticClass="v-input--selection-controls__ripple",e.directives=e.directives||[],e.directives.push({name:"ripple",value:{center:!0}}),this.$createElement("div",e)):null}}})},7764:function(e,t,s){s.d(t,{X:function(){return o}});var i=s(58230),a=s(89155),r=s(34419),n=s(73325);function o(e){e.preventDefault()}t["Z"]=(0,n.Z)(i.Z,a.Z,r.Z).extend({name:"selectable",model:{prop:"inputValue",event:"change"},props:{id:String,inputValue:null,falseValue:null,trueValue:null,multiple:{type:Boolean,default:null},label:String},data(){return{hasColor:this.inputValue,lazyValue:this.inputValue}},computed:{computedColor(){if(this.isActive)return this.color?this.color:this.isDark&&!this.appIsDark?"white":"primary"},isMultiple(){return!0===this.multiple||null===this.multiple&&Array.isArray(this.internalValue)},isActive(){const e=this.value,t=this.internalValue;return this.isMultiple?!!Array.isArray(t)&&t.some((t=>this.valueComparator(t,e))):void 0===this.trueValue||void 0===this.falseValue?e?this.valueComparator(e,t):Boolean(t):this.valueComparator(t,this.trueValue)},isDirty(){return this.isActive},rippleState(){return this.isDisabled||this.validationState?this.validationState:void 0}},watch:{inputValue(e){this.lazyValue=e,this.hasColor=e}},methods:{genLabel(){const e=i.Z.options.methods.genLabel.call(this);return e?(e.data.on={click:o},e):e},genInput(e,t){return this.$createElement("input",{attrs:Object.assign({"aria-checked":this.isActive.toString(),disabled:this.isDisabled,id:this.computedId,role:e,type:e},t),domProps:{value:this.value,checked:this.isActive},on:{blur:this.onBlur,change:this.onChange,focus:this.onFocus,keydown:this.onKeydown,click:o},ref:"input"})},onClick(e){this.onChange(),this.$emit("click",e)},onChange(){if(!this.isInteractive)return;const e=this.value;let t=this.internalValue;if(this.isMultiple){Array.isArray(t)||(t=[]);const s=t.length;t=t.filter((t=>!this.valueComparator(t,e))),t.length===s&&t.push(e)}else t=void 0!==this.trueValue&&void 0!==this.falseValue?this.valueComparator(t,this.trueValue)?this.falseValue:this.trueValue:e?this.valueComparator(t,e)?null:e:!t;this.validate(!0,t),this.internalValue=t,this.hasColor=t},onFocus(e){this.isFocused=!0,this.$emit("focus",e)},onBlur(e){this.isFocused=!1,this.$emit("blur",e)},onKeydown(e){}}})},94930:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{attrs:{"grid-list-xs":""}},[s("v-overlay",{attrs:{value:e.overlay}},[s("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}}),s("v-btn",{attrs:{icon:""},on:{click:function(t){e.overlay=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"500px",transition:"dialog-transition"},model:{value:e.approveResultsDialog,callback:function(t){e.approveResultsDialog=t},expression:"approveResultsDialog"}},[s("v-card",[s("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},[e._v(" Confirm "),s("v-spacer"),s("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.approveResultsDialog=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-card-title",[e._v(" Are you sure you want to approve results? ")]),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"success"},on:{click:e.approveResults}},[s("v-icon",[e._v("mdi-check")]),e._v("Proceed")],1)],1)],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"1000px",transition:"dialog-transition"},model:{value:e.candidates.dialog,callback:function(t){e.$set(e.candidates,"dialog",t)},expression:"candidates.dialog"}},[s("v-card",[s("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},[e._v(" Select Practitioner To Enroll "),s("v-spacer"),s("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.candidates.dialog=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-card-title",[s("v-text-field",{staticClass:"ma-2",attrs:{label:"Omang Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("candidates")},"click:clear":function(t){return e.clearSearch("omang","candidates")}},model:{value:e.search.omang,callback:function(t){e.$set(e.search,"omang",t)},expression:"search.omang"}}),s("v-text-field",{staticClass:"ma-2",attrs:{label:"Passport Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("candidates")},"click:clear":function(t){return e.clearSearch("passport","candidates")}},model:{value:e.search.passport,callback:function(t){e.$set(e.search,"passport",t)},expression:"search.passport"}})],1),e.candidates.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.candidates.error_message))]):e._e(),s("v-card-text",[e._v(" "+e._s(e.candidates.selected.length)+" Selected "),s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.candidates.headers,items:e.candidates.results,"item-key":"id",options:e.candidates.options,"server-items-length":e.candidates.total,"footer-props":{"items-per-page-text":e.$t("App.hardcoded-texts.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.candidates.loadingCandidates,"show-select":""},on:{"update:options":function(t){return e.$set(e.candidates,"options",t)}},model:{value:e.candidates.selected,callback:function(t){e.$set(e.candidates,"selected",t)},expression:"candidates.selected"}})],1),s("v-card-actions",[s("v-btn",{attrs:{color:"success",disabled:0===e.candidates.selected.length},on:{click:e.enroll}},[e._v("Enroll Selected")])],1)],1)],1),s("v-card",{staticClass:"mx-auto",attrs:{"max-width":"900",outlined:""}},[s("v-card-title",{staticClass:"primary darken-1 white--text text-uppercase font-weight-bold"},[e._v(" KITSO Scheduled Exam ")]),s("v-card-text",{staticClass:"my-3"},[s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("v-btn",{attrs:{disabled:!e.canEnroll,color:"secondary",dark:"",small:""},on:{click:function(t){return e.getCandidates(!0,"waitingexam")}}},[s("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-playlist-check")]),s("span",[e._v("Enroll Candidates")])],1),s("br"),s("br"),s("v-btn",{attrs:{disabled:!e.canApproveResults,color:"success",dark:"",small:""},on:{click:function(t){e.approveResultsDialog=!0}}},[s("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check")]),s("span",[e._v("Approve Resultss")])],1)],1),s("v-divider",{attrs:{vertical:""}}),s("v-col",{attrs:{cols:"8"}},[s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Name:")])]),s("v-col",{attrs:{cols:"8"}},[s("v-chip",{staticClass:"ma-2"},[e._v(" "+e._s(e.exam.name)+" ")])],1)],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Course:")])]),s("v-col",{attrs:{cols:"8"}},[s("v-chip",{staticClass:"ma-2"},[e._v(" "+e._s(e.exam.course.name)+" ")])],1)],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Start Date:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.startdate))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("End Date:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.enddate))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Status:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.status.display))])],1)],1)],1)],1)],1),s("br"),s("v-card",[s("v-card-title",[e._v(" Enrolled Candidates "),s("v-spacer"),s("v-btn",{attrs:{color:"error",small:"",disabled:0===e.candidates.selected.length||"yes"===e.exam.status.code},on:{click:e.unenroll}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-close-outline")]),e._v("Un Enroll Selected ")],1),s("v-spacer"),e.resultsMode?[s("v-btn",{attrs:{color:"success",disabled:e.exam&&e.exam.status&&"yes"===e.exam.status.code},on:{click:e.saveResults}},[e._v("Save Results")]),e._v("     "),s("v-btn",{attrs:{color:"primary"},on:{click:e.deactivateAddResults}},[e._v("Hide Results")])]:s("v-btn",{attrs:{color:"primary"},on:{click:e.activateAddResults}},[e.exam&&e.exam.status&&"yes"===e.exam.status.code?[e._v(" View Results ")]:[e._v(" Add Results ")]],2)],2),s("v-card-title",[s("v-text-field",{staticClass:"ma-2",attrs:{label:"Omang Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("enrolled")},"click:clear":function(t){return e.clearSearch("omang","enrolled")}},model:{value:e.search.omang,callback:function(t){e.$set(e.search,"omang",t)},expression:"search.omang"}}),s("v-text-field",{staticClass:"ma-2",attrs:{label:"Passport Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("enrolled")},"click:clear":function(t){return e.clearSearch("passport","enrolled")}},model:{value:e.search.passport,callback:function(t){e.$set(e.search,"passport",t)},expression:"search.passport"}})],1),e.enrolled.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.enrolled.error_message))]):e._e(),s("v-card-text",[s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.enrolled.headers,items:e.enrolled.results,"item-key":"id",options:e.enrolled.options,"server-items-length":e.enrolled.total,"footer-props":{"items-per-page-text":e.$t("App.hardcoded-texts.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.enrolled.loadingEnrolled,"show-select":""},on:{"update:options":function(t){return e.$set(e.enrolled,"options",t)}},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.item;return[s("tr",{on:{click:function(t){return e.clickIt(i)}}},[s("td",[s("v-checkbox",{attrs:{color:"red",value:i,"hide-details":"",disabled:"yes"===e.exam.status.code},on:{click:function(e){e.stopPropagation()}},model:{value:e.candidates.selected,callback:function(t){e.$set(e.candidates,"selected",t)},expression:"candidates.selected"}})],1),s("td",[e._v(e._s(i.surname))]),s("td",[e._v(e._s(i.given))]),s("td",[e._v(e._s(i.birthDate))]),s("td",[e._v(e._s(i.gender))]),s("td",[e._v(e._s(i.omang[0]))]),s("td",[e._v(e._s(i.passport[0]))]),e.resultsMode?["score"==e.exam.mode?e._l(e.exam.assessments,(function(t){return s("td",{key:i.id+t.code},[s("v-text-field",{attrs:{readonly:e.exam&&e.exam.status&&"yes"===e.exam.status.code,"error-messages":e.examResults[i.examId][t.code].errors,outlined:"","hide-details":"auto",dense:""},on:{click:function(e){e.stopPropagation()},input:function(t){return e.validateScore(i.examId)}},model:{value:e.examResults[i.examId][t.code].score,callback:function(s){e.$set(e.examResults[i.examId][t.code],"score",s)},expression:"examResults[item.examId][assessment.code].score"}})],1)})):"noscore"==e.exam.mode?s("td",[s("v-select",{attrs:{readonly:e.exam&&e.exam.status&&"yes"===e.exam.status.code,items:e.scoreAssessment,label:"Score",clearable:""},on:{click:function(e){e.stopPropagation()},input:function(t){return e.validateScore(i.examId)}},model:{value:e.examResults[i.examId]["marks"].score,callback:function(t){e.$set(e.examResults[i.examId]["marks"],"score",t)},expression:"examResults[item.examId]['marks'].score"}})],1):e._e(),s("td",["Pass"===e.examResults[i.examId]["exam-assessment"]?s("v-chip",{attrs:{dark:"",color:"green"},on:{click:function(e){e.stopPropagation()}}},[e._v(" "+e._s(e.examResults[i.examId]["exam-assessment"])+" ")]):e._e(),"Fail"===e.examResults[i.examId]["exam-assessment"]||"Incomplete"===e.examResults[i.examId]["exam-assessment"]?s("v-chip",{attrs:{dark:"",color:"red"},on:{click:function(e){e.stopPropagation()}}},[e._v(" "+e._s(e.examResults[i.examId]["exam-assessment"])+" ")]):e._e()],1)]:e._e()],2)]}}]),model:{value:e.candidates.selected,callback:function(t){e.$set(e.candidates,"selected",t)},expression:"candidates.selected"}})],1)],1)],1)},a=[],r=(s(26699),{props:["queries"],data(){return{overlay:!1,resultsMode:!1,approveResultsDialog:!1,registrationDate:"",registrationDateFormatted:"",registrationDateMenu:!1,exam:{enddate:"",status:{},course:{},assessments:[]},examResults:{},search:{name:"",omang:"",passport:""},enrolled:{options:{itemsPerPage:5},total:0,prevPage:-1,link:[],terms:{},results:[],headers:[{text:"Surname",value:"surname"},{text:"Given Name(s)",value:"given"},{text:"Birth Date",value:"birthDate"},{text:"Gender",value:"gender"},{text:"OMANG",value:"omang"},{text:"Passport",value:"passport"}],loadingEnrolled:!1,update_again:{rerun:!1,restart:!1},error_message:null},candidates:{selected:[],dialog:!1,options:{itemsPerPage:10},total:0,prevPage:-1,link:[],terms:{},results:[],headers:[{text:"Surname",value:"surname"},{text:"Given Name(s)",value:"given"},{text:"Birth Date",value:"birthDate"},{text:"Gender",value:"gender"},{text:"OMANG",value:"omang"},{text:"Passport",value:"passport"}],loadingCandidates:!1,update_again:{rerun:!1,restart:!1},error_message:null},applicantStatus:"",scoreAssessment:[{text:"Pass",value:"pass"},{text:"Fail",value:"fail"},{text:"Incomplete",value:"incomplete"}]}},watch:{"candidates.options":{handler(){this.getCandidates()},deep:!0},"enrolled.options":{handler(){this.getEnrolled()},deep:!0}},computed:{canEnroll(){return!(!this.exam.enddate||this.$moment(this.exam.enddate).isBefore(this.$moment().format("YYYY-MM-DD")))},canApproveResults(){return!this.exam||!this.exam.status||"yes"!==this.exam.status.code}},methods:{formatDate(e){if(!e)return null;const[t,s,i]=e.split("-");return`${i}-${s}-${t}`},selectAll(){this.candidates.selected=this.candidates.selected.concat(this.candidates.results)},unselectDisabled(e){if(e.disabled){let t=this.candidates.selected.findIndex((t=>t.id===e.id));t>-1&&this.candidates.selected.splice(t,1)}},approveResults(){this.approveResultsDialog=!1,this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify({exam:this.queries.exam,registrationDate:this.registrationDate})};fetch("/site/kitso/approveResults",e).then((e=>{this.overlay=!1,200===e.status?(this.$store.commit("setMessage",{type:"success",text:"Results approved successfully"}),this.getExam(),this.getEnrolled()):this.$store.commit("setMessage",{type:"error",text:"Failed to generate registrations for some few candidates, try again."})})).catch((()=>{this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to generate registrations for some few candidates, try again."})}))},clickIt:function(e){this.$router.push({path:"/custom/kitso-person-exam?schedule="+this.queries.exam+"&practitioner="+e.id+"&path=/components/kitso/"})},validateScore(e){let t=0,s=!1,i=!0;if("noscore"!==this.exam.mode){for(let a of this.exam.assessments){this.examResults[e][a.code].errors=[];let r=this.examResults[e][a.code].score;if(r&&r.toString().split(".").length>1&&!r.toString().split(".")[1]&&(this.examResults[e][a.code].errors=["Incomplete number"],s=!0),isNaN(r)){this.examResults[e][a.code].errors=["Must be a number"],s=!0;break}r?t+=parseFloat(r):i=!1,t>100&&(this.examResults[e][a.code].errors=["Total Exceeds 100"],s=!0)}s||!i?this.examResults[e]["exam-assessment"]="":this.exam.course.passmark>t?this.examResults[e]["exam-assessment"]="Fail":this.exam.course.passmark<=t&&(this.examResults[e]["exam-assessment"]="Pass")}else{let t=this.examResults[e]["marks"].score;t&&"pass"==t?this.examResults[e]["exam-assessment"]="Pass":t&&"fail"==t?this.examResults[e]["exam-assessment"]="Fail":t&&"incomplete"==t&&(this.examResults[e]["exam-assessment"]="Incomplete")}},activateAddResults(){this.resultsMode=!0;for(let e of this.exam.assessments)this.enrolled.headers.push({text:e.display,value:e.code});this.enrolled.headers.push({text:"Assessment",value:"exam-assessment"})},deactivateAddResults(){this.resultsMode=!1;for(let t of this.exam.assessments){let e=this.enrolled.headers.findIndex((e=>e.value===t.code));this.enrolled.headers.splice(e,1)}let e=this.enrolled.headers.findIndex((e=>"exam-assessment"===e.value));this.enrolled.headers.splice(e,1)},saveResults(){this.examResults.mode=this.exam.mode,this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(this.examResults)};fetch("/site/kitso/saveResults",e).then((e=>{this.overlay=!1,200===e.status?this.$store.commit("setMessage",{type:"success",text:"Results saved successfully"}):this.$store.commit("setMessage",{type:"error",text:"Failed to save results."})})).catch((()=>{this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to save results."})}))},enroll(){this.candidates.dialog=!1,this.overlay=!0;let e={resourceType:"Bundle",type:"transaction",entry:[]};for(let s of this.candidates.selected){let t={resourceType:"Basic",meta:{profile:["http://ihris.org/fhir/StructureDefinition/kitso-practitioner-exam-profile"]},extension:[{url:"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference",valueReference:{reference:"Practitioner/"+s.id}},{url:"http://ihris.org/fhir/StructureDefinition/kitso-exam-scheduling-reference",valueReference:{reference:"Basic/"+this.queries.exam}}]};e.entry.push({resource:t,request:{method:"POST",url:"Basic"}})}let t={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(e)};fetch("/site/kitso/enrollCandidates",t).then((e=>{this.candidates.selected=[],this.overlay=!1,201===e.status||200===e.status?(this.getEnrolled(),this.$store.commit("setMessage",{type:"success",text:"Candidates Enrolled Successfully"})):this.$store.commit("setMessage",{type:"error",text:"Failed to enroll candidates."})})).catch((()=>{this.candidates.selected=[],this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to enroll candidates."})}))},unenroll(){this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify({candidates:this.candidates.selected,exam:this.queries.exam})};fetch("/site/kitso/unenrollCandidates",e).then((e=>{this.overlay=!1,this.candidates.selected=[],201===e.status||200===e.status?(this.getEnrolled(),this.$store.commit("setMessage",{type:"success",text:"Candidates Un Enrolled Successfully"})):this.$store.commit("setMessage",{type:"error",text:"Failed to un enroll candidates."})})).catch((()=>{this.candidates.selected=[],this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to un enroll candidates."})}))},getExam(){fetch("/fhir/Basic/"+this.queries.exam).then((e=>{e.json().then((async e=>{let t=e.extension.filter((e=>"http://ihris.org/fhir/StructureDefinition/kitso-exam-assessment-type"===e.url));this.exam.assessments=[];for(let a of t)this.exam.assessments.push({code:a.valueCoding.code,display:a.valueCoding.display});this.exam.name=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-basic-name"===e.url)).valueString,this.exam.startdate=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/start-date"===e.url)).valueDate,this.exam.enddate=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/end-date"===e.url)).valueDate,this.exam.mode=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-mode-of-assessment"===e.url))?.valueCoding?.code;let s=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-training-course"===e.url))?.valueReference?.reference;await fetch("/fhir/Basic/"+s.split("/")[1]).then((e=>{e.json().then((e=>{this.exam.course.name=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-basic-name"===e.url)).valueString,this.exam.course.passmark=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/training-course-pass-mark"===e.url)).valueDecimal}))}));let i=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-course-evaluated"===e.url));i&&("yes"===i.valueCoding.code?i.valueCoding.display="Evaluated and Approved":(i.valueCoding.display="Evaluation in Progress",i.valueCoding.code),this.exam.status=i.valueCoding)}))}))},clearSearch:function(e,t){this.search[e]="",this[t].terms.practitioner="",this.buildTerms(t)},checkRerunCandidates(){!this.candidates.loadingCandidates&&this.candidates.update_again.rerun&&(this.getCandidates(this.candidates.update_again.restart),this.candidates.update_again={rerun:!1,restart:!1})},checkRerunEnrolled(){!this.enrolled.loadingEnrolled&&this.enrolled.update_again.rerun&&(this.getEnrolled(this.enrolled.update_again.restart),this.enrolled.update_again={rerun:!1,restart:!1})},async buildTerms(e){"candidates"===e?this.getCandidates(!0):"enrolled"===e&&(this.enrolled.terms={},await this.getDataPractitioner(e),this.getEnrolled(!0))},getDataPractitioner(e){return new Promise(((t,s)=>{let i="";if(this.search.omang&&(i="?identifier="+this.search.omang),this.search.passport&&(i?i+="&identifier="+this.search.passport:i="?identifier="+this.search.passport),!i)return t();let a="/fhir/Practitioner"+i;fetch(a).then((i=>{i.json().then((async s=>{let i=[];if(s.entry&&s.entry.length>0)for(let e of s.entry)i.push("Practitioner/"+e.resource.id);i.length>0?this[e].terms["practitioner"]=i.join(","):this[e].terms["practitioner"]="Practitioner/fakeprct",t()})).catch((()=>{s()}))})).catch((()=>{s()}))}))},getCandidates(e,t){if(t&&(this.applicantStatus=t),this.candidates.dialog||(this.candidates.selected=[]),this.candidates.dialog=!0,this.candidates.loadingCandidates)return this.candidates.update_again.rerun=!0,void(this.candidates.update_again.restart=this.candidates.update_again.restart||e);this.candidates.loadingCandidates=!0,this.candidates.error_message=null;let s="";if(e&&(this.candidates.options.page=1),this.candidates.options.page>1&&(this.candidates.options.page===this.candidates.prevPage-1?s=this.candidates.link.find((e=>"previous"===e.relation)).url:this.candidates.options.page===this.candidates.prevPage+1&&(s=this.candidates.link.find((e=>"next"===e.relation)).url),s=s.replace("/fhir?","/fhir/Practitioner?"),s=s.substring(s.indexOf("/fhir/")),-1===s.indexOf("_sort=-_lastUpdated")&&(s+="&_sort=-_lastUpdated"),-1===s.indexOf("_total=accurate")&&(s+="&_total=accurate")),""===s){let e=this.candidates.options.itemsPerPage,t="";for(let s in this.candidates.options.sortBy)t&&(t+=","),this.candidates.options.sortDesc[s]&&(t+="-"),t+=this.candidates.options.sortBy[s];s="/fhir/Practitioner?&_count="+e+"&_sort=-_lastUpdated&_total=accurate"}let i="";this.search.omang&&(i="&identifier="+this.search.omang),this.search.passport&&(i?i+="&identifier="+this.search.passport:i="?identifier="+this.search.passport),s+=i,this.candidates.prevPage=this.candidates.options.page,fetch(s).then((e=>{e.json().then((async e=>{if(this.candidates.results=[],e.total>0){this.candidates.link=e.link;for(let t of e.entry){let e={id:t.resource.id};e.surname=t.resource.name[0].family,e.given=t.resource.name[0].given.join(", "),e.birthDate=t.resource.birthDate,e.gender=t.resource.gender,e.gender=await this.$fhirutils.lookup(e.gender,"http://hl7.org/fhir/administrative-gender"),e.omang=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='omang').value"),e.passport=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='passport').value"),this.candidates.results.push(e)}}this.candidates.total=e.total,this.candidates.loadingCandidates=!1,this.checkRerunCandidates()})).catch((e=>{this.candidates.loadingCandidates=!1,this.candidates.error_message="Unable to load results.",this.checkRerunCandidates(),console.log(e)}))})).catch((e=>{this.candidates.loadingCandidates=!1,this.candidates.error_message="Unable to load results.",this.checkRerunCandidates(),console.log(e)}))},getEnrolled(e){if(this.enrolled.selected=[],this.enrolled.dialog=!0,this.enrolled.loadingEnrolled)return this.enrolled.update_again.rerun=!0,void(this.enrolled.update_again.restart=this.enrolled.update_again.restart||e);this.enrolled.loadingEnrolled=!0,this.enrolled.error_message=null;let t="";if(e&&(this.enrolled.options.page=1),this.enrolled.options.page>1&&(this.enrolled.options.page===this.enrolled.prevPage-1?t=this.enrolled.link.find((e=>"previous"===e.relation)).url:this.enrolled.options.page===this.enrolled.prevPage+1&&(t=this.enrolled.link.find((e=>"next"===e.relation)).url),t=t.replace("/fhir?","/fhir/Basic?"),t=t.substring(t.indexOf("/fhir/")),-1===t.indexOf("_profile=http://ihris.org/fhir/StructureDefinition/kitso-practitioner-exam-profile")&&(t+="&_profile=http://ihris.org/fhir/StructureDefinition/kitso-practitioner-exam-profile"),-1===t.indexOf("kitsoscheduledexam=Basic/"+this.queries.exam)&&(t=t+"&kitsoscheduledexam=Basic/"+this.queries.exam),-1===t.indexOf("_include=Basic:practitioner")&&(t+="&_include=Basic:practitioner"),-1===t.indexOf("_sort=-_lastUpdated")&&(t+="&_sort=-_lastUpdated"),-1===t.indexOf("_total=accurate")&&(t+="&_total=accurate")),""===t){let e=this.enrolled.options.itemsPerPage,s="";for(let t in this.enrolled.options.sortBy)s&&(s+=","),this.enrolled.options.sortDesc[t]&&(s+="-"),s+=this.enrolled.options.sortBy[t];t="/fhir/Basic?_profile=http://ihris.org/fhir/StructureDefinition/kitso-practitioner-exam-profile&kitsoscheduledexam=Basic/"+this.queries.exam+"&_include=Basic:practitioner&_count="+e+"&_sort=-_lastUpdated&_total=accurate"}let s=Object.keys(this.enrolled.terms);for(let i of s)Array.isArray(this.enrolled.terms[i])?this.enrolled.terms[i].length>0&&(t+="&"+i+"="+this.enrolled.terms[i].join(",")):this.enrolled.terms[i]&&(t+="&"+i+"="+this.enrolled.terms[i]);this.enrolled.prevPage=this.enrolled.options.page,fetch(t).then((e=>{e.json().then((async e=>{if(this.enrolled.results=[],e.total>0){this.enrolled.link=e.link;for(let t of e.entry){if("Practitioner"!==t.resource.resourceType)continue;let s={id:t.resource.id};s.surname=t.resource.name[0].family,s.given=t.resource.name[0].given.join(", "),s.birthDate=t.resource.birthDate,s.gender=t.resource.gender,s.gender=await this.$fhirutils.lookup(s.gender,"http://hl7.org/fhir/administrative-gender"),s.omang=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='omang').value"),s.passport=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='passport').value");for(let t of e.entry){if(!t.resource.extension)continue;let e=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference"===e.url))?.valueReference?.reference;if("Practitioner/"+s.id===e&&t.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/kitso-practitioner-exam-profile")){let e;if(s.examId=t.resource.id,"score"===this.exam.mode){this.examResults[t.resource.id]||this.$set(this.examResults,t.resource.id,{});for(let e of this.exam.assessments){let s="";for(let i of t.resource.extension)if(i.url==="http://ihris.org/fhir/StructureDefinition/"+e.code+"-score"){s=i.valueDecimal;break}s&&!this.examResults[t.resource.id][e.code]?this.$set(this.examResults[t.resource.id],e.code,{score:s,errors:[]}):s||this.examResults[t.resource.id][e.code]||this.$set(this.examResults[t.resource.id],e.code,{score:"",errors:[]})}}else"noscore"===this.exam.mode&&(e=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/passfail-score"===e.url))?.valueCoding?.code,e||(e=""),this.$set(this.examResults,t.resource.id,{}),this.$set(this.examResults[t.resource.id],"marks",{score:e,errors:[]}));let i=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/exam-assessment"===e.url));i&&!this.examResults[t.resource.id]["exam-assessment"]?this.$set(this.examResults[t.resource.id],"exam-assessment",i.valueCoding.display):i||this.examResults[t.resource.id]["exam-assessment"]||this.$set(this.examResults[t.resource.id],"exam-assessment","")}}this.enrolled.results.push(s)}}this.enrolled.total=e.total,this.enrolled.loadingEnrolled=!1,this.checkRerunEnrolled()})).catch((e=>{this.enrolled.loadingEnrolled=!1,this.enrolled.error_message="Unable to load results.",this.checkRerunEnrolled(),console.log(e)}))})).catch((e=>{this.enrolled.loadingEnrolled=!1,this.enrolled.error_message="Unable to load results.",this.checkRerun(),console.log(e)}))},hasTask(e){return this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.special&&this.$store.state.user.obj.permissions.special.special.id&&this.$store.state.user.obj.permissions.special.special.id[e]||this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.navigation&&this.$store.state.user.obj.permissions.special.navigation.id&&this.$store.state.user.obj.permissions.special.navigation.id[e]}},created(){this.getExam(),this.getEnrolled()}}),n=r,o=s(43736),l=s(43453),d=s.n(l),c=s(63150),u=s(32371),h=s(37118),p=s(83702),m=s(95424),v=s(82102),f=s(4228),g=s(40865),x=s(4497),b=s(11418),y=s(96428),k=s(51058),_=s(90624),C=s(62877),R=s(43986),S=s(99762),$=s(55978),D=s(36656),w=(0,o.Z)(n,i,a,!1,null,null,null),P=w.exports;d()(w,{VBtn:c.Z,VCard:u.Z,VCardActions:h.h7,VCardSubtitle:h.Qq,VCardText:h.ZB,VCardTitle:h.EB,VCheckbox:p.Z,VChip:m.Z,VCol:v.Z,VContainer:f.Z,VDataTable:g.Z,VDialog:x.Z,VDivider:b.Z,VIcon:y.Z,VOverlay:k.Z,VProgressCircular:_.Z,VRow:C.Z,VSelect:R.Z,VSpacer:S.Z,VTextField:$.Z,VToolbar:D.Z})}}]);
//# sourceMappingURL=3107.dc9df4e1.js.map