"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[9966],{55533:function(e,t,i){i.d(t,{Z:function(){return r}});var s=i(48085),a=i(73325),r=(0,a.Z)(s.Z).extend({name:"v-subheader",props:{inset:Boolean},render(e){return e("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},35030:function(e,t,i){i.d(t,{w:function(){return r}});i(26699);var s=i(9669),a=i.n(s);const r={data(){return{dashboards:[],ignoreDashboards:["testing","test","Testing","Test"],tags:[]}},methods:{getTags(e){return new Promise(((t,i)=>{let s="/dashboards/api/saved_objects/_find?type=tag&per_page=10000";e&&(s+="&page="+e),fetch(s).then((e=>{e.json().then((e=>{let s=Math.ceil(e.total/e.per_page);e.saved_objects&&(this.tags=this.tags.concat(e.saved_objects)),e.page<s?this.getTags(e.page+1).then((()=>{t()})).catch((()=>{i()})):t()})).catch((()=>{i()}))})).catch((()=>{i()}))}))},getDashboards(){return new Promise(((e,t)=>{let i={type:"dashboard",excludeExportDetails:!0,includeReferencesDeep:!1},s={method:"POST",headers:{"kbn-xsrf":!0,"Content-Type":"application/json"},redirect:"manual",data:i};a()("/dashboards/api/saved_objects/_export",s).then((t=>{if("string"===typeof t.data){let e=t.data&&t.data.split("\n"),s=!0;for(let t=0;t<e.length-1;t++)if(e[t].trim())try{const i=JSON.parse(e[t]);for(let e of i.references){if("tag"!==e.type)continue;let t=this.tags.find((t=>t.id===e.id));if(this.ignoreDashboards.includes(t.attributes.name)){s=!1;break}}s&&this.dashboards.push({id:i.id,title:i.attributes.title})}catch(i){console.error("Error parsing JSON:",i)}let a=e[e.length-1];if(a.trim())try{const e=JSON.parse(a);for(let t of e.references){if("tag"!==t.type)continue;let e=this.tags.find((e=>e.id===t.id));if(this.ignoreDashboards.includes(e.attributes.name)){s=!1;break}}s&&this.dashboards.push({id:e.id,title:e.attributes.title})}catch(i){console.error("Error parsing final JSON object:",i)}}else if("object"===typeof t.data){let e=!0;for(let i of t.data.references){if("tag"!==i.type)continue;let t=this.tags.find((e=>e.id===i.id));if(this.ignoreDashboards.includes(t.attributes.name)){e=!1;break}}e&&this.dashboards.push({id:t.data.id,title:t.data.attributes.title})}e()})).catch((e=>{console.log(e),t()}))}))}},created(){this.loading=!0,this.getTags().then((()=>{this.getDashboards().then((()=>{this.loading=!1})).catch((()=>{this.loading=!1}))})).catch((()=>{this.loading=!1}))}}},95722:function(e,t,i){i.r(t),i.d(t,{default:function(){return C}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",[i("v-card-title",[i("v-row",[i("v-col",[i("h4",{staticClass:"font-weight-medium"},[i("v-icon",{staticClass:"mr-2",attrs:{color:"primary",size:"28"}},[e._v("mdi-tablet-dashboard")]),e._v(" Dashboard ")],1)]),i("v-col",[i("v-select",{attrs:{items:e.dashboards,"item-text":"title","item-value":"id",label:"Other Dashboards"},on:{change:function(t){return e.$router.push("/dashboard/"+e.dashboard)}},model:{value:e.dashboard,callback:function(t){e.dashboard=t},expression:"dashboard"}})],1),i("v-col",{staticClass:"ml-2"},[i("v-row",{attrs:{justify:"end"},scopedSlots:e._u([{key:"label",fn:function(){return[i("h5",{staticClass:"description"},[e._v("Filter By: ")])]},proxy:!0}])},[i("fhir-reference-dashboard",{attrs:{initialValue:"Location/"+e.getData.location,baseMax:"1",baseMin:"0",constraints:"undefined","display-type":"tree",edit:"true",field:"partOf",label:"Region/District/SubCounty/Facility",max:"1",min:"0",path:"Location.partOf","readOnlyIfSet:undefined":"","sliceName:undefined":"","slotProps:Object":"","source:Object":"","subFields:undefined":"",targetResource:"Location"},on:{selectFacilityForDashboard:e.onSelectedFacility}})],1)],1)],1)],1),i("v-divider"),i("v-card-text",{staticStyle:{height:"90vh"}},[e.selectedFacility?i("iframe",{staticStyle:{border:"none"},attrs:{src:"/dashboards/app/dashboards#/view/"+e.$route.params.id+"?embed=true&_a=(description:'',filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,key:ihris-related-group.keyword,negate:!f,params:(query:'"+e.selectedFacility+"'),type:phrase),query:(match_phrase:(ihris-related-group:'"+e.selectedFacility+"')))))&hide-filter-bar=true",height:"100%",width:"100%"}}):e._e(),e.getData.location&&!e.selectedFacility?i("iframe",{staticStyle:{border:"none"},attrs:{src:"/dashboards/app/dashboards#/view/"+e.$route.params.id+"?embed=true&_a=(description:'',filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,key:ihris-related-group.keyword,negate:!f,params:(query:'Location/"+e.getData.location+"'),type:phrase),query:(match_phrase:(ihris-related-group:'Location/"+e.getData.location+"')))))&hide-filter-bar=true",height:"100%",width:"100%"}}):e._e(),e.getData.location||e.selectedFacility?e._e():i("iframe",{staticStyle:{border:"none"},attrs:{src:"/dashboards/app/dashboards#/view/"+e.$route.params.id+"?embed=true",height:"100%",width:"100%"}})])],1)},a=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ihris-element",{attrs:{edit:e.edit,loading:e.loading},scopedSlots:e._u([{key:"form",fn:function(){return["tree"==e.displayType?i("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,"max-height":"500px","min-width":"290px","offset-y":"",transition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on;return[i("v-text-field",e._g({attrs:{disabled:e.disabledAll||e.disabled,"error-messages":e.errors,label:e.display,loading:e.loading,rules:e.rules,"append-icon":"mdi-arrow-down-drop-circle-outline",dense:"","hide-details":"auto",outlined:"",readonly:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(e._s(e.display)+" "),e.required?i("span",{staticClass:"red--text font-weight-bold"},[e._v("*")]):e._e()]},proxy:!0}],null,!0),model:{value:e.displayValue,callback:function(t){e.displayValue=t},expression:"displayValue"}},s))]}}],null,!1,881804525),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[e.disabled||e.preset&&"resource_add"===e.$route.name?e._e():i("v-card",[i("v-treeview",{attrs:{active:e.active,items:e.items,"load-children":e.fetchChildren,loading:e.loading,"multiple-active":!1,open:e.open,activatable:"","item-disabled":"locked","return-object":"","selection-type":"independent"},on:{"update:active":function(t){e.active=t},"update:open":function(t){e.open=t}}})],1)],1):e._e()]},proxy:!0},{key:"header",fn:function(){return[e._v(" "+e._s(e.display)+" ")]},proxy:!0},{key:"value",fn:function(){return[e._v(" "+e._s(e.displayValue)+" ")]},proxy:!0}])})},o=[],n=(i(26699),i(22130));const l=i(17673),d="http://hl7.org/fhir/StructureDefinition/";var c={name:"fhir-reference-dashboard",props:["field","label","sliceName","targetProfile","targetResource","min","max","base-min","base-max","slotProps","path","sub-fields","edit","readOnlyIfSet","constraints","displayType","initialValue","overrideValue"],components:{IhrisElement:n.Z},data:function(){return{source:{path:"",data:{}},value:{reference:""},qField:"valueReference",loading:!1,search:"",menu:!1,items:[],select:"",resource:"",awaitingSearch:!1,displayValue:"",preset:!1,disabled:!1,disabledAll:!1,errors:[],lockWatch:!1,active:[],open:[],treeLookup:{},allAllowed:!0,isFacility:!1}},created:function(){this.setupData()},watch:{slotProps:{handler(){this.lockWatch||this.setupData()},deep:!0},search:function(e){this.awaitingSearch||setTimeout((()=>{e&&e.length>1&&this.querySelections(this.search),this.awaitingSearch=!1}),500),this.awaitingSearch=!0},select:function(e){this.$route.path==="/dashboard/"+this.$route.params.id&&this.$emit("selectFacilityForDashboard",e),this.value.reference=e,this.getDisplay()},active:function(){this.active.length?(this.select=this.active[0],this.displayValue=this.treeLookup[this.select.id]):(this.select=void 0,this.displayValue=""),this.menu=!1}},methods:{setupData:function(){if(this.targetResource="Location",this.targetProfile="Location",this.targetProfile&&this.targetResource&&(this.targetProfile.replace(d,"")===this.targetResource?this.allAllowed=!0:this.allAllowed=!1,this.resource=this.targetResource),"tree"===this.displayType&&this.setupTreeItems(),this.slotProps&&this.slotProps.source){if(this.source={path:this.slotProps.source.path+"."+this.field,data:{}},this.slotProps.source.fromArray)this.source.data=this.slotProps.source.data;else{let e=this.$fhirutils.pathFieldExpression(this.field),t=this.$fhirpath.evaluate(this.slotProps.source.data,e);this.source.data=t[0]}this.source.data&&(this.preset=!0,this.select=this.source.data.reference,this.lockWatch=!0)}this.disabled=this.readOnlyIfSet&&this.preset},setupTreeItems:async function(){let e=this.initialValue;this.overrideValue&&(e=this.overrideValue),this.loading=!0;let t={};t=e?{partof:e}:{"partof:missing":!0},t._count=500;let i="/fhir/"+this.resource+"?_sort=name&"+l.stringify(t);this.items=[],this.addItems(i,this.items)},checkFacility:function(e){let t={_id:e,_profile:"http://ihris.org/fhir/StructureDefinition/ihris-facility",_summary:"count"},i="/fhir/"+this.resource+"?_sort=name&"+l.stringify(t);return new Promise((e=>{fetch(i).then((t=>{t.ok?t.json().then((t=>{t.total&&1==t.total&&(this.isFacility=!0),e()})).catch((t=>{console.log("failed to check facility for",i,t),e()})):(console.log("failed to check facility for",i,t.status),e())})).catch((t=>{console.log("failed to check facility for",i,t),e()}))}))},checkChildren:function(e){let t={partof:e.id,_summary:"count"},i="/fhir/"+this.resource+"?_sort=name&"+l.stringify(t);return new Promise((t=>{fetch(i).then((s=>{s.ok?s.json().then((i=>{i.total&&i.total>0&&(e.children=[]),t()})).catch((e=>{console.log("failed to check children for",i,e),t()})):(console.log("failed to check children for",i,s.status),t())})).catch((e=>{console.log("failed to check children for",i,e),t()}))}))},addItems:function(e,t){fetch(e).then((i=>{i.ok?i.json().then((async e=>{if(e.entry&&e.entry.length>0)for(let i of e.entry){let e=!this.allAllowed&&!i.resource.meta.profile.includes(this.targetProfile),s={id:i.resource.resourceType+"/"+i.resource.id,name:i.resource.name,locked:e};await this.checkChildren(s),this.treeLookup[s.id]=s.name,t.push(s)}if(e.link){let i=e.link.find((e=>"next"===e.relation));i?this.addItems(i.url,t):this.loading=!1}else this.loading=!1})).catch((t=>{console.log("Failed to add items for",e,t),this.loading=!1})):(console.log("Failed to add items for",e,i.status),this.loading=!1)})).catch((t=>{console.log("Failed to add items for",e,t),this.loading=!1}))},fetchChildren:function(e){let t={partof:e.id,_count:1e3},i="/fhir/"+this.resource+"?_sort=name&"+l.stringify(t);return this.loading=!0,this.addItems(i,e.children),new Promise((e=>{let t=0;const i=()=>{!this.loading||t++>200?e():setTimeout(i,200)};i()}))},querySelections:function(e){this.loading=!0;let t={"name:contains":e};this.targetProfile.endsWith(this.resource)||(t._profile=this.targetProfile);let i="/fhir/"+this.resource+"?_sort=name&"+l.stringify(t);fetch(i).then((e=>{e.ok?e.json().then((async e=>{if(this.items=[],e.entry&&e.entry.length)for(let t of e.entry){let e=t.resource.resourceType+"/"+t.resource.id,i={value:e};i.text=await this.$fhirutils.resourceLookup(e),this.items.push(i)}this.loading=!1})):(console.log("Failed to retrieve",this.resource),this.loading=!1)}))},getDisplay:function(){(!this.edit||this.preset)&&this.value&&this.value.reference&&(this.loading=!0,this.$fhirutils.resourceLookup(this.value.reference).then((e=>{if(this.displayValue=e,this.edit||"http://ihris.org/fhir/StructureDefinition/ihris-jurisdiction"!==this.targetProfile)this.displayValue=e;else{let e={_id:this.value.reference.split("/").pop(),status:"active","_include:iterate":"Location:partof"},t="/fhir/Location?_sort=name&"+l.stringify(e),i=[],s=[];fetch(t).then((e=>{e.ok&&e.json().then((e=>{for(let t of s){let s=e.entry.find((e=>e.resource.type[0].coding[0].code==t));i.push(s.resource.name)}this.displayValue=i.join(",")}))}))}"tree"!==this.displayType&&this.items.push({text:e,value:this.value.reference}),this.loading=!1})))}},computed:{index:function(){return this.slotProps?this.slotProps.input:void 0},display:function(){return this.slotProps&&this.slotProps.input?this.slotProps.input.label:this.label},required:function(){return(this.index||0)<this.min},rules:function(){return this.required?[e=>!!e||this.display+" is required"]:[]}}},h=c,u=i(43736),f=i(43453),p=i.n(f),g=i(32371),m=i(41152),y=i(55978),b=i(98080),v=(0,u.Z)(h,r,o,!1,null,null,null),_=v.exports;p()(v,{VCard:g.Z,VMenu:m.Z,VTextField:y.Z,VTreeview:b.Z});var k=i(35030),w={name:"dashboard",components:{FhirReferenceDashboard:_},props:["id"],mixins:[k.w],data(){return{selectedFacility:"",facilityName:"",dashboard:""}},methods:{onSelectedFacility:function(e){this.selectedFacility=e.id,this.facilityName=e.name}},computed:{getData(){return this.$store.state.user}},created(){this.$store.state.minidrawer=!0,this.dashboard=this.$route.params.id}},x=w,S=i(37118),D=i(82102),P=i(11418),V=i(96428),F=i(62877),$=i(43986),T=(0,u.Z)(x,s,a,!1,null,null,null),C=T.exports;p()(T,{VCard:g.Z,VCardText:S.ZB,VCardTitle:S.EB,VCol:D.Z,VDivider:P.Z,VIcon:V.Z,VRow:F.Z,VSelect:$.Z})}}]);
//# sourceMappingURL=dashboard.80c2da88.js.map